
@{
    Layout = null;
}

<input type="hidden" id="tramo1" value="@ViewData["tramo1_vd"]" />
<input type="hidden" id="tramo2" value="@ViewData["tramo2_vd"]" />
<input type="hidden" id="valort1" value="@ViewData["valort1_vd"]" />
<input type="hidden" id="valort2" value="@ViewData["valort2_vd"]" />
<input type="hidden" id="tipousuario" value="@ViewData["tipousuario"]" />

<div id="loading" style="position: absolute; left: 50%; top: 50%; z-index: 50000; display: none">
    <b>cargando ...</b>
    <img src="../../../images/loading_page.gif" width="20" height="20" />
</div>

<div id="saving" style="position: absolute; left: 50%; top: 50%; z-index: 50000; display: none">
    <b>Guardando...</b>
    <img src="../../../images/loading_page.gif" width="20" height="20" />
</div>
<br />

@*<div class="row">
        <div class="col-lg-2 col-xs-12"></div>
        <div class="col-lg-3 col-xs-12">
            <input type="text" class="form-control text-left" id="idcliente" placeholder="Nombre de cliente" autofocus>
        </div>
        <div class="col-lg-2 col-xs-12">
            <select id="idcomuna" class="form-control "></select>
        </div>
        <div class="col-lg-3 col-xs-12">
            <input type="text" class="form-control text-left" id="idcondominio" placeholder="Nombre de condominio" autofocus>
        </div>
        <div class="col-lg-2 col-xs-12"></div>
    </div>
    <br />*@

<div class="row">
    <div class="col-lg-1">
        Tipo Zona
    </div>

    <div class="col-lg-2">
        <select id="listado_zonas" class="form-control" data-live-search="true">
            <option value="">--Cargando Datos--</option>
        </select>
    </div>

    <div class="col-lg-1">
        Comuna
    </div>

    <div class="col-lg-2">
        <select id="listado_comunas" class="form-control" data-live-search="true">
            <option value="">--Seleccione Zona--</option>
        </select>
    </div>

    <div class="col-lg-1">
        Tipo Pedido
    </div>

    <div class="col-lg-2">
        <select id="listado_tipopedido" class="form-control" data-live-search="true">
            <option value="2">Todos</option>
            <option value="0">Fishbox</option>
            <option value="1">Restaurant</option>
        </select>
    </div>
    <div class="col-lg-1">
    </div>

    <div class="col-lg-2">
        <button class="btn btn-primary" id="idBuscar" title="Buscar" style="width:100%"><i class="glyphicon glyphicon-search"></i> Buscar Pedidos</button>
    </div>
</div>

<div class="row">
    <div class="col-lg-2">
        <div style="display:flex; flex-direction: row; ">
            Fecha inicio
            &nbsp;&nbsp;&nbsp;
            <input type="date" class="form-control" id="idfecha" value="@DateTime.Now.ToString("yyyy-MM-dd")">
        </div>
    </div>
    <div class="col-lg-2">
        <div style="display:flex; flex-direction: row; ">
            Fecha termino
            &nbsp;&nbsp;&nbsp;
            <input type="date" class="form-control" id="idfechatermino" value="@DateTime.Now.ToString("yyyy-MM-dd")">
        </div>
    </div>
    <div class="col-lg-1">
        Conductores
    </div>
    <div class="col-lg-1">
        <select id="listado_choferes" class="form-control" data-live-search="true">
            <option value="">--Cargando Datos--</option>
        </select>
    </div>
    <div class="col-lg-1">
        Vehículo
    </div>
    <div class="col-lg-1">
        <select id="listado_patente" class="form-control" data-live-search="true">
            <option value="">--Cargando Datos--</option>
        </select>
    </div>
    <div class="col-lg-1 text-right" style="padding-top:10px">
        Cargados
    </div>
    <div class="col-lg-1">
        <select id="listado_cargados" class="form-control" data-live-search="true">
            <option value="0">Todos</option>
            <option value="1">Por Cargar</option>
            <option value="2">Cargados</option>
            <option value="3">Entregados</option>
        </select>
    </div>
</div>
<br />

<div class="row">
    <div class="col-lg-2 col-md-2 col-xs-2"></div>
    <div class="col-lg-12 col-md-12 col-xs-12">
        <div id="idDivPartialProcesoPedidos">
        </div>
    </div>
    <div class="col-lg-2 col-md-2 col-xs-2"></div>
</div>

<div class="modal fade modal-open" id="modal_pesos_reales" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">

        @*style="max-width:1200px;width:60%"*@
        <div class="modal-content">
            <div class="modal-header header_modal">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_modifica_peso_item_pedido">Pesos Reales</h3>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div id="nombrecliente"></div>
                    </div>
                    <div class="col-lg-6">
                        <button type="button" id="btn_agregar_item_reales" class="btn btn-success pull-right">+ Agregar</button>
                    </div>
                </div>
                <div id="divpartialdetallepedido">
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-lg-2 col-xs-12 text-left" style="padding-bottom:5px;padding-top:0px;"><label style="font-size: 14px">Cajas</label></div>
                        <div class="col-lg-2 col-xs-12" style="padding-bottom:15px;padding-top:0px;"><input type="text" class="form-control numerico_int text-right" id="cajas" placeholder="Cajas" onfocus="this.select()" /></div>
                        <div class="col-lg-2 col-xs-12 text-left" style="padding-bottom:5px;padding-top:0px;"><label style="font-size: 14px">Bolsas</label></div>
                        <div class="col-lg-2 col-xs-12" style="padding-bottom:15px;padding-top:0px;"><input type="text" class="form-control numerico_int text-right" id="bolsas" placeholder="Bolsas" onfocus="this.select()" /></div>
                        <div class="col-lg-2 col-xs-12 text-left " style="font-size: 14px;padding-top:0px;padding-bottom:15px">
                            <span class="form-group">
                                Aprobar Inspección
                                <input id="apruebainspeccion" type="checkbox" />
                            </span>

                        </div>
                        <div class="col-lg-2 col-xs-12 text-left" style="font-size: 14px;padding-top:0px;padding-bottom:15px">
                            <span class="form-group">
                                Facturar
                                <input id="ok_facturar" type="checkbox" />
                            </span>
                        </div>
                        <div class="col-lg-2 col-xs-12 text-left" style="font-size: 14px;padding-top:0px;padding-bottom:15px">
                            <span class="form-group">
                                Entrega Boleta
                                <input id="entregaboleta" type="checkbox" />
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-cs-12" style="font-size:medium;color:red">
                            <div class="row">
                                <div class="col-lg-2 col-md-4 col-xs-12 text-left" style="padding-top:5px">
                                    Status
                                </div>
                                <div class="col-lg-9 col-md-4 col-xs-12 text-left">
                                    <select id="avancereales" class="form-control">
                                        <option value="0">Detenido</option>
                                        <option value="1">Iniciado</option>
                                        <option value="2">Incompleto</option>
                                        <option value="3">Finalizado</option>
                                    </select>
                                </div>
                                <div class="col-lg-1 col-md-4 col-xs-12 text-left"></div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-cs-12" style="font-size:large;color:red;">
                            <div class="row">
                                <div class="col-lg-8 col-md-8 col-xs-12">
                                    <label for="pesototal">Peso Total</label>
                                </div>
                                <div class="col-lg-4 col-md-4 col-xs-12">
                                    <input id="pesototal" style="width:70px" type="text" class="form-control text-right" value="0" disabled />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-cs-12" style="font-size:large;color:red;">
                            <div class="row">
                                <div class="col-lg-8 col-md-8 col-xs-12">
                                    <label for="montototal">Monto Total</label>
                                </div>
                                <div class="col-lg-4 col-md-4 col-xs-12">
                                    <input id="montototal" style="width:70px" type="text" class="form-control text-right" value="0" disabled />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-xs-12">
                            <button type="button" id="btn_guardar_avancereales" class="btn btn-primary pull-right">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade modal-open" id="modal_fotos_despacho" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">

        @*style="max-width:1200px;width:60%"*@
        <div class="modal-content">
            <div class="modal-header header_modal">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_modifica_fotos_despacho">Fotos del despacho</h3>
            </div>
            <div class="modal-body">
                <div id="idPartialVerFoto"></div>
            </div>
        </div>
    </div>
</div>

<style>
    .modal-open {
        overflow: scroll;
    }
</style>

<form method="POST" id="form_modifica_peso_item_pedido" class="form_modifica_peso_item_pedido" role="form">
    <div class="modal fade" id="modal_modifica_peso_item_pedido" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_modifica_peso_item_pedido" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="width:100%">
        <div class="modal-dialog  modal-xs">
            <div class="modal-content">
                <div class="modal-header header_modal">
                    @*<button type="button" class="close" aria-label="Close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>*@
                    <h3 class="titulo_modal_h3 modal-title" id="myModalLabel_modifica_peso_item_pedido">Peso Real<span style="font-size: 16px"></span></h3>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="referencia_modifica_peso_item_pedido" />
                    <input type="hidden" id="codigo_modifica_peso_item_pedido" />
                    <div class="row">
                        <div class="col-lg-3">
                            Nombre
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control" id="producto_modifica_peso_item_pedido" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3 col-xs-9">
                            Cantidad
                        </div>
                        <div class="col-lg-9 col-xs-9">
                            <div class="row">
                                <div class="col-lg-8 col-xs-8" style="padding-right:0">
                                    <input type="text" class="form-control validate[required]" id="cantidad_modifica_peso_item_pedido" readonly>
                                </div>
                                <div class="col-lg-4 col-xs-4" style="padding-left:0">
                                    <input type="text" id="unidad_modifica_peso_item_pedido" class="form-control" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-xs-9">
                            Descuento
                        </div>
                        <div class="col-lg-9 col-xs-9">
                            <div class="row">
                                <div class="col-lg-8 col-xs-8">
                                    <input type="text" class="form-control validate[required]" id="cantidad_modifica_peso_item_descuento" onfocus="this.select()" value="0" onkeypress="return SoloNumerosDecimales(event, '0.0', 2, 2);">
                                </div>
                                <div class="col-lg-4 col-xs-4">
                                    <div>%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-xs-12">
                            Presentacion
                        </div>
                        <div class="col-lg-9 col-xs-12" id="divlistado_presentaciones_modifica_peso_item_pedido" style="width:75%">
                        </div>
                    </div>

                    <br />

                    <div class="row">
                        <div class="col-lg-3 col-xs-12"></div>
                        <div class="col-lg-4 col-xs-6" style="padding-bottom:20px">
                            Cabeza
                            <input id="cabeza_modifica_peso_item_pedido" type="checkbox" disabled='disabled' />
                        </div>
                        <div class="col-lg-1 col-xs-12"></div>
                        <div class="col-lg-4 col-xs-6" style="padding-bottom:20px">
                            Esquelon
                            <input id="esquelon_modifica_peso_item_pedido" type="checkbox" disabled='disabled' />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-xs-9">
                            Cant.Real
                        </div>
                        <div class="col-lg-9 col-xs-9">
                            <div class="row">
                                <div class="col-lg-8 col-xs-8" style="padding-right:0">
                                    <input type="text" class="form-control validate[required] numerico_dec" id="cantidadreal_modifica_peso_item_pedido" onfocus="this.select()">
                                </div>
                                <div class="col-lg-4 col-xs-4" style="padding-left:0">
                                    <input type="text" id="unidad_modifica_peso_item_pedido_real" class="form-control" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            Observación
                        </div>
                        <div class="col-lg-9">
                            <textarea id="obsdet_modifica_peso_item_pedido_real" class="form-control limpiar" rows="3"></textarea>
                        </div>
                    </div>

                    <input type="hidden" id="precio_modifica_peso_item_pedido" />
                    <input type="hidden" id="valor_modifica_peso_item_pedido" />

                </div>

                <div class="modal-footer">
                    <div class="text-center">
                        <div class="row">
                            <div class="col-lg-4 col-cs-4">
                                <button type="button" class="btn btn-default cerrar_item_modificado pull-left" data-dismiss="modal">Cerrar</button>
                            </div>
                            <div class="col-lg-4 col-cs-4" style="font:bold;font-size:large;color:red;">
                                Anular
                                <input id="anulado_modifica_peso_item_pedido_real" type="checkbox" />
                            </div>
                            <div class="col-lg-4 col-cs-4">
                                <input type="submit" class="btn btn-primary guardar_peso_item_modificado pull-right" value="Guardar" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="modal fade" id="modal_peso_real" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_modifica_peso_item_pedido" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="width:100%">
    <div class="modal-dialog  modal-xs">
        <div class="modal-content">
            <div class="modal-header header_modal">
                @*<button type="button" class="close" aria-label="Close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>*@
                <h3 class="titulo_modal_h3 modal-title" id="myModalLabel_modifica_peso_item_pedido">Peso Real<span style="font-size: 16px"></span></h3>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-3">
                        Observación
                    </div>
                    <div class="col-lg-9">
                        <textarea id="obsdet_peso_real" class="form-control limpiar" rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="text-center">
                    <div class="row">
                        <div class="col-lg-4 col-cs-4">
                            <button type="button" id="btn_anula_peso_real" class="btn btn-default pull-left" data-dismiss="modal">Cerrar</button>
                        </div>
                        <div class="col-lg-4 col-cs-4" style="font:bold;font-size:large;color:red;">
                            Anular
                            <input id="anula_peso_real" type="checkbox" />
                        </div>
                        <div class="col-lg-4 col-cs-4">
                            <input type="submit" id="btn_guarda_peso_real" class="btn btn-primary pull-right" value="Guardar" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="POST" id="form_guardar_pedido_modificado" class="form_guardar_pedido" role="form" onsubmit="return false">
    <div class="modal fade" id="modal_guardar_pedido_modificado" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_guardar" aria-hidden="true" data-focus-on="input:first" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="min-width: 30% !important; max-width:60% !important">
            <div class="modal-content">
                <div class="modal-header header_modal">
                    <h3 class="titulo_modal_h3 modal-title" id="myModalLabel_guardar">Guardar <span style="font-size: 16px"></span></h3>
                </div>
                <div class="modal-body">

                    <input type="hidden" class="limpiar" id="registro_pedido">
                    <input type="hidden" class="limpiar" id="fecha_pedido">

                    <input value="" class="validate[required,past[#fechaent_pedido]]" type="hidden" id="fechaactual_pedido" name="fechaactual_pedido" />

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Vendedor</label>
                        </div>
                        <div class="col-lg-9">
                            <select id="vendedor_pedido" class="form-select input-sm" disabled='disabled'></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Cliente</label>
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control text-left validate[required] limpiar" id="cliente_pedido" disabled='disabled'>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Direccion</label>
                        </div>
                        <div class="col-lg-9">
                            <textarea type="text" class="form-control text-left validate[required] limpiar" id="direccion_pedido" rows="3" disabled='disabled'></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Comuna</label>
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control text-left validate[required] limpiar" id="comuna_pedido" disabled='disabled'>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Total</label>
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control text-left validate[required] limpiar" id="total_pedido" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Fecha Ent</label>
                        </div>
                        <div class="col-lg-9">
                            @*<input type="date" data-date-format='yyyy-mm-dd' class="form-control text-left validate[required] limpiar" id="fechaent_pedido">*@
                            <input value="" class="validate[required,future[#fechaactual_pedido]]" type="date" id="fechaent_pedido" name="fechaent_pedido" style="height:30px;font-size: 13px;" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Hora Ent</label>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" class="form-control text-left validate[required] limpiar numerico_int" maxlength="2" id="horaent_pedido">
                        </div>
                        <div class="col-lg-4">
                            <button type="button" class="btn btn-danger horacambiar">+</button>
                            <button type="button" class="btn btn-danger horacambiar">-</button>
                        </div>
                        <div class="col-lg-1 col-xs-6">
                            AM
                            <input id="am_pedido" type="checkbox" class="ampm_pedido" />
                        </div>
                        <div class="col-lg-1 col-xs-6">
                            PM
                            <input id="pm_pedido" type="checkbox" class="ampm_pedido" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            <label>Observación</label>
                        </div>
                        <div class="col-lg-9">
                            <textarea id="observacion_pedido" class="form-control limpiar" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <div class="text-center">
                        <div class="row">
                            <div class="col-lg-6 col-xs-6">
                                <button type="button" class="btn btn-default cerrarpedidoModificado pull-left" data-dismiss="modal">Cerrar</button>
                            </div>
                            <div class="col-lg-6 col-xs-6">
                                <input type="submit" class="btn btn-primary guardarpedidomodificado pull-right" value="Guardar" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@*<div class="modal fade" id="modal_cambiar_estado" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog center-block" style="min-width: 40% !important; max-width:90% !important">
            <div class="modal-content">
                <div class="modal-header header_modal">
                    <button id="close_modal_pesos_reales" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title titulo_modal_h3" id="myModalLabel_cambiar_estado">Cambio Estado</h3>
                </div>
                <div class="modal-body">
                    <div id="divlistado_estados">
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="row">
                                <div class="col-lg-10 col-xs-12">
                                    <div class="row">
                                        <div class="col-lg-2 col-xs-12 text-left" style="padding-bottom:5px;padding-top:0px;"><label style="font-size: 14px">Cajas</label></div>
                                        <div class="col-lg-2 col-xs-12" style="padding-bottom:15px;padding-top:0px;"><input type="text" class="form-control numerico_int text-right" id="cajas" placeholder="Cajas" onfocus="this.select()" /></div>
                                        <div class="col-lg-2 col-xs-12 text-left" style="padding-bottom:5px;padding-top:0px;"><label style="font-size: 14px">Bolsas</label></div>
                                        <div class="col-lg-2 col-xs-12" style="padding-bottom:15px;padding-top:0px;"><input type="text" class="form-control numerico_int text-right" id="bolsas" placeholder="Bolsas" onfocus="this.select()" /></div>
                                        <div class="col-lg-2 col-xs-12 text-left" style="font-size: 14px;padding-top:0px;padding-bottom:15px">
                                            <span class="form-group">
                                                Facturar
                                                <input id="ok_facturar" type="checkbox" />
                                            </span>
                                        </div>
                                        <div class="col-lg-2 col-xs-12 text-left" style="font-size: 14px;padding-top:0px;padding-bottom:15px">
                                            <span class="form-group">
                                                Entrega Boleta
                                                <input id="entregaboleta" type="checkbox" />
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-xs-12">
                                    <button type="button" id="ok_cambiar_estado" class="btn btn-primary pull-right" style="width:100%">Guardar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>*@

<div class="modal fade" id="modal_cambiar_operario" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="max-width:1200px;width:60%">
        <div class="modal-content modal-sm center-block">
            <div class="modal-header header_modal">
                <button id="close_modal_pesos_reales" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_cambiar_operario">Establece Empacador</h3>
            </div>
            <div class="modal-body">
                <div id="divlistado_operarios">
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="row">
                            <div class="col-lg-4 col-xs-12 text-center">
                                <button type="button" id="ok_comanda" class="btn btn-warning text-left" style="width:100%;padding-left:2px">Comanda</button>
                            </div>
                            <div class="col-lg-4 col-xs-12 text-center">
                                <button type="button" id="ok_etiqueta" class="btn btn-danger text-center" style="width:100%;padding-left:2px">Etiqueta</button>
                            </div>
                            <div class="col-lg-4 col-xs-12">
                                <button type="button" id="ok_cambiar_operario" class="btn btn-primary text-right" style="width:100%">Guardar</button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <button type="button" id="ok_comanda_etiqueta" class="btn btn-success">Comanda/Etiqueta</button>
                            <button type="button" data-dismiss="modal" class="btn btn-default">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade actualiza_scroll" id="modal_etiqueta" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="max-width:1200px;width:60%">
        <div class="modal-content modal-lg">
            <div class="modal-header header_modal">
                <div class="row">
                    <div class="col-lg-10 col-xs-10">
                        <h3 class="modal-title titulo_modal_h3" id="myModalLabel_cambiar_operario">Etiqueta</h3>
                    </div>
                    <div class="col-lg-2 col-xs-2">
                        <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="pdfetiqueta">
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-lg-12 col-xs-12">
                                <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade actualiza_scroll" id="modal_unidacomandaempaque" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="max-width:1200px;width:60%">
        <div class="modal-content modal-lg">
            <div class="modal-header header_modal">
                <div class="row">
                    <div class="col-lg-10 col-xs-10">
                        <h3 class="modal-title titulo_modal_h3">Insumo requerido</h3>
                    </div>
                    <div class="col-lg-2 col-xs-2">
                        <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="pdfcomandauno">
                    </div>
                    <div class="row">
                        <div class="col-lg-10 col-xs-10">
                            <h3 class="modal-title titulo_modal_h3">Etiqueta</h3>
                        </div>

                    </div>
                    <div id="pdfetiquetados">
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-lg-12 col-xs-12">
                                <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_comanda" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="max-width:1200px;width:60%">
        <div class="modal-content modal-lg">
            <div class="modal-header header_modal">
                <div class="row">
                    <div class="col-lg-10 col-xs-10">
                        <h3 class="modal-title titulo_modal_h3" id="myModalLabel_cambiar_operario">Insumo requerido</h3>
                    </div>
                    <div class="col-lg-2 col-xs-2">
                        <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="pdfcomanda">
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-lg-12 col-xs-12">
                                <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_aceptado" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content modal-sm">
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-lg-12 col-xs-12">
                        <button type="button" data-dismiss="modal" class="btn btn-success center-block">Cantidad aceptada **</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_confirma_guardarpesoreal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_pesoreal" aria-hidden="true">
    <div class="modal-dialog modal-dialog_eliminar">
        <div class="modal-content">
            <div class="modal-header header_modal_advertencia">
                <button id="close_modal_confirmaguardar" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_pesoreal">Confirmar </h3>
                <input type="hidden" id="opcion_cierre_hidden" />
            </div>
            <div class="modal-body text-center">
                <span style="font-size:14px">¿Está seguro que desea guardar cambios?</span>
                <div class="form-horizontal">
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancelar</button>
                        <input id="btn_confirmaguardarpesoreal" type="submit" class="btn btn-primary" data-dismiss="modal" value="Aceptar" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_confirma_imprimircomanda" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_pesoreal" aria-hidden="true">
    <div class="modal-dialog modal-dialog_eliminar">
        <div class="modal-content">
            <div class="modal-header header_modal_advertencia">
                <button id="close_modal_confirmaguardar" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_imprimircomanda">Confirmar Comanda </h3>
                <input type="hidden" id="opcion_cierre_hidden" />
            </div>
            <div class="modal-body text-center">
                <span style="font-size:14px">¿Está seguro que desea generar otra comanda?</span>
                <div class="form-horizontal">
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancelar</button>
                        <input id="btn_confirmaimprimircomanda" type="submit" class="btn btn-primary" data-dismiss="modal" value="Aceptar" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_boleta" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="max-width:1200px;width:60%">
        <div class="modal-content modal-lg">
            <div class="modal-header header_modal">
                <div class="row">
                    <div class="col-lg-10 col-xs-10">
                        <h3 class="modal-title titulo_modal_h3" id="myModalLabel_Boleta">Boleta</h3>
                    </div>
                    <div class="col-lg-2 col-xs-2">
                        <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div id="pdfboleta">
                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-lg-12 col-xs-12">
                                <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_productos_agregar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header header_modal">
                <button id="close_modal_agregarprod" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="titulo_modal_h3 modal-title" id="myModalLabel_guardar">Productos <span style="font-size: 16px"></span></h3>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-11">
                        <input type="text" class="form-control" id="idproducto_pedidos" placeholder="Producto" autofocus>
                    </div>
                    <div class="col-xs-1">
                        <button type="button" class="btn btn-warning" id="btn_buscar_productos_pedidos" style="width: 100%;padding-left:0;padding-right:0" title="Buscar"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
                <div id="partialProductosAgregar">
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-lg-12 col-xs-12">
                            <button type="button" data-dismiss="modal" class="btn btn-primary center-block">Cerrar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<form method="POST" id="form_cantidad" class="form_cantidad" role="form">
    <div class="modal fade" id="modal_cantidad_pedidos" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_cantidad" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header header_modal">
                    <button type="button" class="close" aria-label="Close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class="titulo_modal_h3 modal-title" id="myModalLabel_cantidad">Detalle Producto <span style="font-size: 16px"></span></h3>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="codigo_cant_pedidos" />
                    <input type="hidden" id="registro_cant_pedidos" />

                    <div class="row">
                        <div class="col-lg-3">
                            Nombre
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control" id="producto_cant_pedidos" readonly>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-xs-3">
                            Cantidad
                        </div>
                        <div class="col-lg-9 col-xs-9">
                            <div class="row">
                                <div class="col-lg-8 col-xs-8" style="padding-right:0">
                                    <input type="text" class="form-control validate[required] calcula_valor numerico_dec" id="cantidad_cant_pedidos" value="1" onfocus="this.select()">
                                </div>
                                <div class="col-lg-4 col-xs-4" style="padding-left:0">
                                    <input type="text" id="unidad_cant_pedidos" class="form-control" disabled>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3 col-xs-12">
                            Presentacion
                        </div>
                        <div class="col-lg-9 col-xs-12" id="divlistado_presentaciones_pedidos" style="width:75%">
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-lg-3 col-xs-12"></div>
                        <div class="col-lg-4 col-xs-6">
                            Cabeza
                            <input id="cabeza_cant_pedidos" type="checkbox" />
                        </div>
                        <div class="col-lg-1 col-xs-12"></div>
                        <div class="col-lg-4 col-xs-6">
                            Esquelon
                            <input id="esquelon_cant_pedidos" type="checkbox" />
                        </div>
                    </div>
                    <br />

                    <div class="row">
                        <div class="col-lg-3">
                            Precio
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control validate[custom[ValidaNumero]] calcula_valor numerico_int" id="precio_cant_pedidos" onfocus="this.select()">
                            <input type="hidden" id="costo_cant_pedidos">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            Valor
                        </div>
                        <div class="col-lg-9">
                            <input type="text" class="form-control validate[custom[ValidaNumero]]" id="valor_cant_pedidos" readonly>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-3">
                            Observación
                        </div>
                        <div class="col-lg-9">
                            <textarea id="obsdet_cant_pedidos" class="form-control limpiar" rows="3"></textarea>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <div class="text-center">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                        <input type="submit" class="guardarCarrito btn btn-primary" value="Agregar" />

                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="modal fade" id="modal_confirma_eliminar_item_despacho" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel_itemdespacho" aria-hidden="true">
    <div class="modal-dialog modal-dialog_eliminar">
        <div class="modal-content">
            <div class="modal-header_danger header_modal_advertencia">
                <button id="close_modal_confirmaguardar" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title titulo_modal_h3" id="myModalLabel_itemdespacho">Eliminar Item Despacho </h3>
            </div>
            <div class="modal-body text-center">
                <span style="font-size:16px;font-weight:bold">¿Está seguro que desea eliminar item de despacho?</span>
                <div class="form-horizontal">
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancelar</button>
                        <input id="btn_confirmaeliminacionitemdespacho" type="submit" class="btn btn-danger" value="Aceptar" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*@section Scripts {*@

<script type="text/javascript">
    var global_lista = 0;
        var tr_peso_reales = "";
        var global_web = 0;
        var indice_carro = 0;
        var fila_proceso = 0;
        var fila_carrito = 0;
        var cantidad_carro = 0;
        var table_pedidos = "";
        var table_carrito = "";
        var carrito = [];
        var pedidos = [];
        var item_carrito = {};
        var carrito_producto = 0;//1: producto, 2:carrito
        var global_fecha = "";
        var global_telefono = "";
        var global_cliente = "";
        var global_nombrevendedor = "";
        var global_direccion = "";
        var global_comuna = "";
        var global_condominio = "";
        var global_cajas = "";
        var global_total = "";
        var global_fechaent = "";
        var global_horaent = "";
        var global_obs = "";
        var global_operario = "";
        var global_nombreoperario = "";
        var global_avancereales = "";
        var global_am = "";
        var global_pm = "";
        var global_entregaboleta = 0;
        var global_descuento = 0;
        var global_propina = 0;
        var global_costoenvio = 0;
        var global_costoenvio = 0;
        var global_nombreoperario = "";
        var global_registro = "";

        var montominimo = 10;
        var pesominimo = 10;
        var codigominimo = 405;
        var nombreminimo = "PESO MINIMO";
        var valorminimo = 2000;

        var tramo1 = ($("#tramo1").val() == "") ? 0 : parseInt($("#tramo1").val());
        var tramo2 = ($("#tramo2").val() == "") ? 0 : parseInt($("#tramo2").val());
        var valort1 = ($("#valort1").val() == "") ? 0 : parseInt($("#valort1").val());
        var valort2 = ($("#valort2").val() == "") ? 0 : parseInt($("#valort2").val());


    $(document).ready(function () {

        $("#fechaactual_pedido").val(aaaammdd(new Date()));

        cargar_comunas("");
        cargar_minimo();
        cargar_pedidos("");
        cargar_operarios("");


            $("#idBuscar").click(function (e) {
                cargar_pedidos("");
            });

            listarZona();
            listarPatente("");
            listarChoferes("");

            $("#listado_zonas").change(function (e) {
                listarComunas();
            });
            $("#btn_guardar_avancereales").hide();
            $("#btn_agregar_item_reales").hide();
            $('#form_cantidad').validationEngine();
            //debugger
            var tipousuario = $('#tipousuario').val();
            if (tipousuario === 'ADMIN' || tipousuario === 'SUPERVISOR') {
                $("#apruebainspeccion").prop("disabled", false);
            } else {
                $("#apruebainspeccion").prop("disabled", true);
            }
            $('.guardarCarrito').on('click', function (e) {
                e.preventDefault();
                if (!$("#form_cantidad").validationEngine('validate')) {
                    return false;
                }
                var precio = parseInt(($("#precio_cant_pedidos").val() == "") ? 0 : $("#precio_cant_pedidos").val().replace(/\./g, ''));
                var cantidad = parseFloat(($("#cantidad_cant_pedidos").val() == "") ? 0 : $("#cantidad_cant_pedidos").val().replace(/\,/g, '.'));
                var valor = Math.round(precio * cantidad, 0);
                $("#valor_cant_pedidos").val(formatea_miles(parseInt(valor)));
                var c = parseFloat(($("#costo_cant_pedidos").val() == "") ? 0 : $("#costo_cant_pedidos").val().replace(/\,/g, '.'));
                var costo = Math.round(c * cantidad, 0);
                var registro = $("#registro_cant_pedidos").val();
                var codigo = $("#codigo_cant_pedidos").val();
                var nombre = $("#producto_cant_pedidos").val();
                var cantidad = $("#cantidad_cant_pedidos").val().replace(/\,/g, '.');
                var presentacion = $("#presentacion_cant_pedidos").val();
                var cabeza = "0";
                if ($("#cabeza_cant_pedidos").prop('checked')) { cabeza = "1" };
                var esquelon = "0";
                if ($("#esquelon_cant_pedidos").prop('checked')) { esquelon = "1" };
                var unidad = $("#unidad_cant_pedidos").val();
                var precio = $("#precio_cant_pedidos").val().replace(/\./g, '');
                var valor = $("#valor_cant_pedidos").val().replace(/\./g, '');
                var obsdet = $("#obsdet_cant_pedidos").val();
                if (parseFloat(cantidad) > 999999999) {
                    mostrar_msj_error("Cantidad muy grande");
                    $("#ajax_loader").css("display", "none");
                    return false;
                }

                if (cantidad.toString().charAt(cantidad.toString().length - 1) == ".") {
                    mostrar_msj_error("Cantidad no debe dejar punto final");
                    $("#ajax_loader").css("display", "none");
                    return false;
                }
                $("#modal_productos_agregar").modal("hide");
                $("#modal_cantidad_pedidos").modal("hide");

                if (obsdet == null) { obsdet = ''; }

                    var carrito_item_add = [];
                    var carrito_nuevo = {
                        id_indice: indice_carro,
                        codigo: codigo,
                        detalle: nombre,
                        cantidad: parseFloat(cantidad),
                        presentacion: presentacion,
                        cabeza: cabeza,
                        esquelon: esquelon,
                        unidad: unidad,
                        precio: precio,
                        descuento1: 0,
                        valor: valor,
                        costo: costo,
                        obsdet: obsdet
                    }
                    carrito_item_add.push(carrito_nuevo);

                    $("#saving").show();
                    $.ajax({
                        type: "POST",
                        url: '/Pedidos/AgregarItem_ProcesoPedido/',
                        data: JSON.stringify({
                            registro: registro,
                            carrito: carrito_item_add
                        }),
                        async: true,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            //$("#modal_guardar_pedidos").modal("hide");
                            $("#saving").hide();
                            if (data.retornoJson == 1) {
                                mostrar_msj_success('Item guardado correctamente');
                                cargar_detalle_pedido(global_registro);
                                editar_detalle_pedido_agregar();
                            } else if (data.retsornoJson == -1) {
                                mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                                window.location.href = "/../Home/Login";

                            } else {
                                mostrar_msj_error(data.errorJson);
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            mostrar_msj_error("error de Conexion");
                        }
                    });

                    $("#ajax_loader").css("display", "none");
                    $("#modal_cantidad_pedidos").modal("hide");
            });
            $("#btn_buscar_productos_pedidos").click(function (e) {
                e.preventDefault();
                listar_productosAgregar();
                $("#idproducto_pedidos").focus();
            });
            $("#btn_confirmaeliminacionitemdespacho").click(function (e) {
                e.preventDefault();
                table_edicion_pedido.row((tr_peso_reales).parents('tr')).remove().draw();
                let indexElimina = carrito.findIndex(carrito => carrito.codigo === codigominimo);
                debugger;
                if (indexElimina > 0) {
                    carrito.splice(indexElimina, 1);
                }
                $("#modal_confirma_eliminar_item_despacho").modal("hide")
            });


            $('#idcliente').on({
                keypress: function () { typed_into = true; },
                change: function () {
                    cargar_pedidos($('#idcliente').val());
                },
                blur: function () {
                    cargar_pedidos($('#idcliente').val());
                }
            });

            //$('#idcomuna').on({
            //    keypress: function () { typed_into = true; },
            //    focus: function () {
            //        global_comuna = $('#idcomuna').val();
            //    },
            //    change: function () {
            //        if ($('#idcomuna').val() != global_comuna) {
            //            cargar_pedidos_comuna($('#idcomuna').val());
            //        }
            //    },
            //    //blur: function () {
            //    //    if ($('#idcomuna').val() != global_comuna) {
            //    //    cargar_pedidos_comuna($('#idcomuna').val());
            //    //    }
            //    // }
            //});

            $('#idcomuna').on('change', function (e) {
                e.preventDefault();
                global_comuna = $('#idcomuna').val();
                if ($("#idcomuna").val() == "0") {
                    cargar_pedidos_condominio("")
                } else {
                    cargar_pedidos_comuna($('#idcomuna').val());
                }
            });

            $('#idcondominio').on({
                keypress: function () { typed_into = true; },
                focus: function () {
                    global_condominio=$('#idcondominio').val();
                },
                change: function () {
                    if ($('#idcondominio').val() != global_condominio) {
                        cargar_pedidos_condominio($('#idcondominio').val());
                    }
                },
                //blur: function () {
                //    if ($('#idcondominio').val() != global_condominio) {
                //        cargar_pedidos_condominio($('#idcondominio').val());
                //    }
                //}
            });

            $('#form_modifica_peso_item_pedido').validationEngine();

            $('.guardar_peso_item_modificado').on('click', function (e) {
                e.preventDefault();
                if (!$("#form_modifica_peso_item_pedido").validationEngine('validate')) {
                    return false;
                }

                $("#saving").css("display", "");

                var obsdet = $("#obsdet_modifica_peso_item_pedido_real").val();
                var referencia = $("#referencia_modifica_peso_item_pedido").val();
                var descuento1 = parseFloat($("#cantidad_modifica_peso_item_descuento").val());
                var anulado = "0";
                if ($("#anulado_modifica_peso_item_pedido_real").prop('checked')) { anulado = "1" };
                if (anulado == "1" && obsdet.trim()== "") { mostrar_msj_advertencia("Debe justificar anulacion"); return false; }

                if (anulado == "0") {

                    var cantidad = parseFloat(($("#cantidad_modifica_peso_item_pedido").val() == "") ? "0" : $("#cantidad_modifica_peso_item_pedido").val());
                    var cantidadreal = parseFloat(($("#cantidadreal_modifica_peso_item_pedido").val() == "") ? "0" : $("#cantidadreal_modifica_peso_item_pedido").val());

                    var pctdif = (cantidad - cantidadreal) / cantidad * 100;

                    if (pctdif > 0) {
                        if (Math.abs(pctdif) > 20 && obsdet == "") { mostrar_msj_advertencia("Debe justificar diferencia con cantidad pedido"); return false; }
                    } else {
                        if (Math.abs(pctdif) > 20 && obsdet == "") { mostrar_msj_advertencia("Debe justificar diferencia con cantidad pedido"); return false; }
                    }
                    var precio = parseInt(($("#precio_modifica_peso_item_pedido").val() == "") ? "0" : $("#precio_modifica_peso_item_pedido").val().replace(/\./g, ''));
                    var valor = Math.round((precio * cantidadreal) - (precio * cantidadreal*descuento1/100), 0)  ;

                } else {

                    cantidadreal = 0;
                    valor = 0;

                }

                if (cantidadreal.toString().charAt(cantidadreal.toString().length - 1) == ".") {
                    mostrar_msj_error("Cantidad no debe dejar punto final");
                    $("#saving").css("display", "none");
                    return false;
                }

                if (cantidadreal > cantidad*4) {
                    mostrar_msj_error("Cantidad muy grande");
                    $("#saving").css("display", "none");
                    return false;
                }

                carrito.forEach(function (item) {
                    if (item.referencia == referencia) {
                        debugger;
                        item.cantidadreal = cantidadreal;
                        item.valor = valor;
                        item.obsdet = obsdet;
                        item.anulado = anulado;
                        item.descuento1 = descuento1;
                        fila_carrito = item;
                    }
                });

                $("#saving").css("display", "none");
                $("#modal_modifica_peso_item_pedido").modal("hide");

                editar_detalle_pedido();

            });

            $('#modal_pesos_reales').on('shown.bs.modal', function () {
                var table = $('#table_edicion_pedido').DataTable();
                table.columns.adjust();
                $("#nombrecliente").html("Cliente: " + global_cliente+ ", Vendedor: " +global_nombrevendedor);
            });

            $('#modal_cantidad_pedidos').on('shown.bs.modal', function () {
                $('#modal_productos_agregar').addClass("actualiza_scroll");
            });
            $('#modal_productos_agregar').on('shown.bs.modal', function () {
                $('#modal_pesos_reales').addClass("actualiza_scroll");
            });

            $("#btn_guardar_avancereales").click(function (e) {
                $("#modal_confirma_guardarpesoreal").modal("show");
            });

            $('#apruebainspeccion').change(function () {

                    if ($(this).is(':checked')) {
                        $("#ok_facturar").prop("disabled", false);
                    } else {
                        $("#ok_facturar").prop("disabled", true);
                    }
            });


            $("#btn_confirmaguardarpesoreal").click(function (e) {
                e.preventDefault();

                $("#saving").css("display", "");
                //$("#btn_confirmaguardarpesoreal").prop("disabled", true);
                $("#modal_confirma_guardarpesoreal").modal("hide");
                //var ret_pesos_estados = guardarCajasFacturacion();
                //**** validacion cajas***
                var estado = "0";
                var facturar = "0";
                if ($("#ok_facturar").prop('checked')) { facturar = "1" };

                if (facturar == "1") {
                    var estado = "1";
                    //mostrar_msj_error("para enviar a facturar, el pedido debe estar terminado");
                    //return false;
                }

                var entregaboleta = "0";
                if ($("#entregaboleta").prop('checked')) { entregaboleta = "1" };


                var apruebainspeccion = "0";

                if ($("#apruebainspeccion").prop('checked'))
                {
                        apruebainspeccion = "1"
                }
                var ok = 1;
                var total_estado = 0;
                for (let pedido_estado of carrito) {
                    //debugger;
                    var qreal = parseFloat(pedido_estado.cantidadreal == "" || pedido_estado.cantidadreal == "0" ? "0" : pedido_estado.cantidadreal);
                    if (pedido_estado.codigo != codigominimo && qreal == 0 && pedido_estado.obsdet == "") { ok = 0; }
                    if (pedido_estado.valor == "") { pedido_estado.valor = "0"; } else {
                        var precio = parseFloat(pedido_estado.precio);
                        var descuento1 = parseFloat(pedido_estado.descuento1);
                        pedido_estado.valor = Math.round((precio * qreal) - (precio * qreal)*descuento1/100, 0);
                    }
                    total_estado += parseInt(pedido_estado.valor);
                }
                if (ok == 0) {
                    $("#saving").css("display", "none");
                    mostrar_msj_error("Debe ingresar cantidades reales a cada producto");
                    return false;
                }
                var valor = $("#cajas").val();
                if (valor == "") { valor = "0"; }
                var cajas = parseInt(valor);

                var valor = $("#bolsas").val();
                if (valor == "") { valor = "0"; }
                var bolsas = parseInt(valor);

                if (cajas == 0 && bolsas == 0) {
                    $("#saving").css("display", "none");
                    mostrar_msj_advertencia("Debe señalar cantidad de cajas o bolsas");
                    return false;
                }
                //fin validacion cajas****//

                //SACAR CHECK DE INSPECCION
                if ($('#apruebainspeccion').is(':checked')) {
                    //$("#apruebainspeccion").prop("disabled", false);
                    global_avancereales = $("#avancereales").val();
                } else {
                    //$("#ok_facturar").prop("disabled", true);
                    global_avancereales = 0;
                }

                $('#estado_' + fila_proceso).attr("data-pesototal", pesototal);

                var total = 0;
                //for (let pedido of carrito) {
                //    var cantidadreal = parseFloat(pedido.cantidadreal == "" || pedido.cantidadreal == "0" ? "0" : pedido.cantidadreal);
                //    var precio = parseFloat(pedido.precio);
                //    var descuento1 = parseFloat(pedido.descuento1);
                //    pedido.valor = Math.round((precio * cantidadreal) - (precio * cantidadreal)*descuento1/100, 0);
                //    if (pedido.valor == "") { pedido.valor = "0"; }
                //    total += parseInt(pedido.valor);
                //}

                //EL TOTAL YA VIENE CON EL IVA DESDE WEB ORINOCO, EL IVA Y OTROS DETALLES SOLO SE MUESTRA PERO NO SE SUMA AL TOTAL
                $.ajax({
                    type: "POST",
                    url: '/Pedidos/Guardar_AvRealesCambEstado/',
                    data: JSON.stringify({
                            registro: global_registro,
                            total_estado: total_estado,
                            estado: estado,
                            cajas: cajas.toString(),
                            bolsas: bolsas.toString(),
                            am: global_am,
                            pm: global_pm,
                            operario: global_nombreoperario,
                            obs: global_obs,
                            facturar: facturar,
                            entregaboleta: entregaboleta,
                            apruebainspeccion: apruebainspeccion,
                            carrito: carrito,
                            web: global_web,
                            avancereales: global_avancereales,
                            pesototal: $("#pesototal").val(),
                            total: total,
                            descuentos: global_descuento,
                            propinas: global_propina,
                            costoenvio: global_costoenvio,
                            codigominimo: codigominimo,
                        }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //async: false,
                    success: function (data) {
                        if (data.retornojson == "1") {
                            //$("#btn_confirmaguardarpesoreal").prop("disabled", false);
                            $("#btneditar_" + fila_proceso).attr("data-avancereales", global_avancereales);
                            $("#hidden_" + fila_proceso).val(global_avancereales);
                            switch (global_avancereales) {
                                case "0": $("#fila_" + fila_proceso).css('background-color', 'White'); break;
                                case "1": $("#fila_" + fila_proceso).css('background-color', 'Yellow'); break;
                                case "2": $("#fila_" + fila_proceso).css('background-color', 'Orange'); break;
                                case "3": $("#fila_" + fila_proceso).css('background-color', '#88F256'); break;
                            }
                            switch (global_avancereales) {
                                case "0": $("#estado_" + fila_proceso).css('background-color', 'White'); break;
                                case "1": $("#estado_" + fila_proceso).css('background-color', 'Yellow'); break;
                                case "2": $("#estado_" + fila_proceso).css('background-color', 'Orange'); break;
                                case "3": $("#estado_" + fila_proceso).css('background-color', '#88F256'); break;
                            }
                            switch (global_avancereales) {
                                case "0": $("#operario_" + fila_proceso).css('background-color', 'White'); break;
                                case "1": $("#operario_" + fila_proceso).css('background-color', 'Yellow'); break;
                                case "2": $("#operario_" + fila_proceso).css('background-color', 'Orange'); break;
                                case "3": $("#operario_" + fila_proceso).css('background-color', '#88F256'); break;
                            }
                            $('#modal_pesos_reales').modal("hide");
                            $("#saving").css("display", "none");
                            cargar_pedidos("");//
                            imprimirBoleta(global_registro);
                        } else if (data.retornojson == "-1") {
                            mostrar_msj_error(data.mensajejson);
                        } else {
                            mostrar_msj_error(data.errorjson);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        mostrar_msj_error("error de Conexion");
                    }

                });

                $("#saving").css("display", "none");

            });

        $("#ok_cambiar_operario").click(function (e) {
            e.preventDefault();

            $("#saving").css("display", "");
            cambiar_operario();
            $("#saving").css("display", "none");
            $("#modal_cambiar_operario").modal("hide");
        });

            $("#ok_comanda_etiqueta").click(function (e) {
                e.preventDefault();

                var arreglo = $("#modal_cambiar_operario #operario").val();
                var operario = arreglo[0];
                var nombre = $("#operario option:selected").text();
                if (nombre == "") {
                    mostrar_msj_error("debe señalar empacador");
                    return false;
                }
                $("#saving").css("display", "");
                cambiar_operario();
                global_avancereales = "1";
                //guardar_avancereal()
                $.ajax({
                    type: "POST",
                    url: '/Pedidos/ok_Comanda/',
                    data: JSON.stringify(
                        {
                            registro: global_registro,
                            cliente: global_cliente,
                            operario: nombre
                        }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {

                        //debugger
                        if (data.retornoJson == "1") {

                            $("#modal_unidacomandaempaque").modal("show");
                            $("#pdfcomandauno").html("");
                            var iframe = $('<iframe/>', {
                                'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                                'name': 'myname',
                                'id': 'print-iframe',
                                'src': data.documentocomandaJson
                            });
                            $('#pdfcomandauno').html(
                                iframe
                            );

                        } else if (data.retornoJson == "-1") {
                            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                            window.location.href = "/../Home/Login";

                        } else if (data.retornoJson == "-2") {


                            $("#modal_confirma_imprimircomanda").modal("show");
                            $("#modal_confirma_imprimircomanda #myModalLabel_imprimircomanda").text("Confirmar Comanda N°:"+data.contcomanda);


                            //mostrar_msj_advertencia("COMANDA YA GENERADA, DESEA GENERAR OTRA?");
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        mostrar_msj_error("error de Conexion");
                    }
                });
                //etiqueta
                $.ajax({
                    type: "POST",
                    url: '/Pedidos/ok_Etiqueta/',
                    data: JSON.stringify({
                            registro: global_registro
                        }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.retornojson == "1") {

                            $("#pdfetiquetados").html("");
                            var iframe = $('<iframe/>', {
                                'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                                'name': 'myname',
                                'id': 'print-iframe',
                                'src': data.etiquetajson
                            });
                            $('#pdfetiquetados').html(
                                iframe
                            );
                        } else if (data.retornojson == "-1") {
                            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                            window.location.href = "/../Home/Login";

                        } else {
                            mostrar_msj_error(data.mensajejson);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        mostrar_msj_error("error de Conexion");
                    }
                });
                $("#saving").css("display", "none");
                $("#modal_cambiar_operario").modal("hide");

            });

        $("#ok_etiqueta").click(function (e) {
            e.preventDefault();

            $("#saving").css("display", "");
            $.ajax({
                type: "POST",
                url: '/Pedidos/ok_Etiqueta/',
                data: JSON.stringify(
                    {
                        registro: global_registro
                    }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.retornojson == "1") {

                        $("#modal_etiqueta").modal("show");
                        $("#pdfetiqueta").html("");
                        var iframe = $('<iframe/>', {
                            'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                            'name': 'myname',
                            'id': 'print-iframe',
                            'src': data.etiquetajson
                        });
                        $('#pdfetiqueta').html(
                            iframe
                        );
                    } else if (data.retornojson == "-1") {
                        mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                        window.location.href = "/../Home/Login";

                    } else {
                        mostrar_msj_error(data.mensajejson);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mostrar_msj_error("error de Conexion");
                }
            });

            $("#saving").css("display", "none");
            $("#modal_cambiar_operario").modal("hide");

        });

            $('#btn_confirmaimprimircomanda').on('click', function (e) {
                e.preventDefault();

                var arreglo = $("#modal_cambiar_operario #operario").val();
                var operario = arreglo[0];
                var nombre = $("#operario option:selected").text();
                if (nombre == "") {
                    mostrar_msj_error("debe señalar empacador");
                    return false;
                }
                $("#saving").css("display", "");
                cambiar_operario();
                global_avancereales = "1";
                //guardar_avancereal()
                $.ajax({
                    type: "POST",
                    url: '/Pedidos/ok_Comanda/',
                    data: JSON.stringify(
                        {
                            registro: global_registro,
                            cliente: global_cliente,
                            operario: nombre,
                            nuevacantcomanda: 1

                        }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.retornoJson == "1") {

                            $("#modal_comanda").modal("show");
                            $("#pdfcomanda").html("");
                            var iframe = $('<iframe/>', {
                                'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                                'name': 'myname',
                                'id': 'print-iframe',
                                'src': data.documentocomandaJson
                            });
                            $('#pdfcomanda').html(
                                iframe
                            );
                        } else if (data.retornoJson == "-1") {
                            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                            window.location.href = "/../Home/Login";

                        } else {
                            mostrar_msj_error(data);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        mostrar_msj_error("error de Conexion");
                    }
                });

                $("#saving").css("display", "none");
                $("#modal_cambiar_operario").modal("hide");

            });



        $("#ok_comanda").click(function (e) {
            e.preventDefault();

            //debugger
            var arreglo = $("#modal_cambiar_operario #operario").val();
            var operario = arreglo[0];
            var nombre = $("#operario option:selected").text();
            if (nombre == "") {
                mostrar_msj_error("debe señalar empacador");
                return false;
            }
            $("#saving").css("display", "");
            cambiar_operario();
            global_avancereales = "1";
            //guardar_avancereal()

            $.ajax({
                type: "POST",
                url: '/Pedidos/ok_Comanda/',
                data: JSON.stringify(
                    {
                        registro: global_registro,
                        cliente: global_cliente,
                        operario: nombre,
                        nuevacantcomanda: 0
                    }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {

                    if (data.retornoJson == "1") {

                        $("#modal_comanda").modal("show");
                        $("#pdfcomanda").html("");
                        var iframe = $('<iframe/>', {
                            'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                            'name': 'myname',
                            'id': 'print-iframe',
                            'src': data.documentocomandaJson
                        });
                        $('#pdfcomanda').html(
                            iframe
                        );

                    } else if (data.retornoJson == "-1") {
                        mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                        window.location.href = "/../Home/Login";

                    } else if (data.retornoJson == "-2") {

                        $("#modal_confirma_imprimircomanda").modal("show");
                        $("#modal_confirma_imprimircomanda #myModalLabel_imprimircomanda").text("Generar Comanda N°:" + data.cantcomanda );

                        //mostrar_msj_advertencia("COMANDA YA GENERADA, DESEA GENERAR OTRA?");

                    } else {
                        mostrar_msj_error(data);
                    }

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mostrar_msj_error("error de Conexion");
                }
            });

            $("#saving").css("display", "none");
            $("#modal_cambiar_operario").modal("hide");

        });

        $("#am_pedido").click(function (e) {
            if ($("#am_pedido").prop('checked')) { $("#pm_pedido").prop('checked', false) };
        });

        $("#pm_pedido").click(function (e) {
            if ($("#pm_pedido").prop('checked')) { $("#am_pedido").prop('checked', false) };
        });

        $("#btn_guarda_peso_real").click(function (e) {
            e.preventDefault();

            var obsdet = $("#obsdet_peso_real").val();
            if (obsdet == "") {
                //$("#cantreal_" + fila_carrito).val("0");
                //$("#btn_editar_" + fila_carrito).attr("data-cantidadreal","0");
                mostrar_msj_error("Debe justificar cantidad !!");
            } else {
                item_carrito.obsdet = obsdet;
                var anulado = "0";
                if ($("#anula_peso_real").prop('checked')) { anulado = "1" };
                if (anulado == "0") {
                    var cantidad = parseFloat(item_carrito.cantidad);
                    var cantidadreal = parseFloat(item_carrito.cantidadreal);
                    var precio = parseFloat(item_carrito.precio);
                    item_carrito.valor = Math.round(precio * cantidadreal, 0);
                } else {
                    item_carrito.cantidadreal = 0;
                    item_carrito.valor = 0;
                    item_carrito.anulado = "1";
                }
                if (guardar_peso_real(item_carrito) == 1) {
                    $("#btn_editar_" + fila_carrito).attr("data-cantidadreal", item_carrito.cantidadreal);
                    $("#btn_editar_" + fila_carrito).attr("data-valor", item_carrito.valor);
                    sumar_kilos_totales();
                    mostrar_msj_success("cantidad aceptada !!");
                    $("#modal_peso_real").modal("hide");
                }
            }
        });

        $("#btn_anula_peso_real").click(function (e) {
            e.preventDefault();
            $("#cantreal_" + fila_carrito).val("0");
            $("#btn_editar_" + fila_carrito).attr("data-cantidadreal", "0");
            $("#modal_peso_real").modal("hide");
        });

        $("#btn_agregar_item_reales").click(function (e) {
            $("#modal_productos_agregar").modal("show");
            listar_productosAgregar();
        });
        $('#modal_productos_agregar').on('shown.bs.modal', function () {
            table_pedidos.columns.adjust();
        });
        });

    function listarZona() {
        $.getJSON('/Zonas/BuscarZonas/', function (data) {
            var items = "";
            $("#listado_zonas").empty();
            var count = 0;
            items += "<option value='' > --Seleccione</option>";
            $.each(data, function (i, district) {
                count = 1;
                items += "<option value='" + district.tipozona + "' >" + district.tipozona + "</option>";
            });

            if (count == 0) {
                $('#listado_zonas').html("<option value='' >No hay datos</option>");
            } else {
                $('#listado_zonas').html(items);
            }
            $("#listado_zonas").selectpicker('refresh');

        });
    }

    function listarComunas() {
        var region = $("#listado_zonas").val();
        if (region != null) {
            $.getJSON('/Zonas/BuscarComunas/?region=' + region, function (data) {
                var items = "";
                $("#listado_comunas").empty();
                var count = 0;
                items += "<option value='' > --Seleccione</option>";
                $.each(data, function (i, district) {
                    count = 1;
                    items += "<option value='" + district.nombre + "' >" + district.nombre + "</option>";
                });

                if (count == 0) {
                    $('#listado_comunas').html("<option value='' >No hay datos</option>");
                } else {
                    $('#listado_comunas').html(items);
                }
                $("#listado_comunas").selectpicker('refresh');

            });
        }
    }


    function listarPatente(nombre) {
        $.getJSON('/Vehiculos/BuscarPatentes/?nombre_patente=' + nombre, function (data) {
            var items = "";
            $("#listado_patente").empty();
            var count = 0;
            items += "<option value='' > --Seleccione</option>";
            $.each(data, function (i, district) {
                count = 1;
                items += "<option value='" + district.patente + "' >" + district.nombre + "</option>";
            });

            if (count == 0) {
                $('#listado_patente').html("<option value='' >No hay datos</option>");
            } else {
                $('#listado_patente').html(items);
            }
            $("#listado_patente").selectpicker('refresh');

        });
    }

    function listarChoferes(nombre) {
        $.getJSON('/Choferes/BuscarChoferes/?nombre_chofer=' + nombre, function (data) {
            var items = "";
            $("#listado_choferes").empty();
            var count = 0;
            items += "<option value='' > --Seleccione </option>";
            $.each(data, function (i, district) {
                count = 1;
                items += "<option value='" + district.rut + "' >" + district.nombre + "</option>";
            });

            if (count == 0) {
                $('#listado_choferes').html("<option value='' >No hay datos</option>");
            } else {
                $('#listado_choferes').html(items);
            }
            $("#listado_choferes").selectpicker('refresh');

        });
    }

        function imprimirBoleta(registro) {
            $.ajax({
                type: "POST",
                url: '/Pedidos/ok_Imprimir_Boletas/',
                data: JSON.stringify({ registro: registro }),
                contentType: "application/json; charset=utf-8",
                dataType: false,
                success: function (data) {

                    if (data.retornojson == "1") {
                        $("#modal_boleta").modal("show");
                        $("#pdfboleta").html("");
                        var iframe = $('<iframe/>', {
                            'class': 'pdfpreview', // some CSS class to set the width and height of the preview iframe
                            'name': 'myname',
                            'id': 'print-iframe',
                            'src': data.boletajson
                        });
                        $('#pdfboleta').html(
                            iframe
                        );
                        $("#divpartialImprimir_Boletas").html(data);
                    } else {
                        mostrar_msj_error(data.mensajejson);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mostrar_msj_error("error de Conexion al imprimir boleta");
                }
            });
        }

        function listar_productosAgregar() {
            var url_action = '@Html.Raw(Url.Action("partialListadoProductosAgregar", "Pedidos", new {material = "_material",lista="lista_"}))';
            url_action = url_action.replace("_material", $('#idproducto_pedidos').val()).replace("lista_", global_lista);
            $("#saving").css("display", "");
            $.ajax({
                contentType: false,
                processData: false,
                type: 'POST',
                url: url_action,
                success: function (result) {
                    $("#saving").hide();
                    if (result == -1) {
                        mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                        window.location.href = "/../Home/Login";
                    } else {
                        $("#partialProductosAgregar").html(result);
                    }
                }
            });
        }

        function cargar_presentaciones(codigoproducto) {

            $.ajaxSetup({
                async: false
            });

            $.getJSON('/Productos/GetPresentacionesCodPres/?codigoproducto=' + codigoproducto, function (data) {
                //var items = "<option value='n'>--Seleccione--</option>";
                var items = "";
                //$("#modal_producto_agregar #unidad_prod").empty();
                var count = 0;
                $.each(data, function (i, district) {
                    count = 1;
                    items += "<option style='height:30px' value='" + district.codigo + "' >" + district.nombre + "</option>";
                });
                //$('#modal_cantidad_pedidos #divlistado_presentaciones_pedidos').html("<select id='presentacion_cant_pedidos' class='form-control form-select input-sm validate[required]' style='width:100%;'>" + items + "</select>");

                if (count == 0) {
                    $('#modal_cantidad_pedidos #divlistado_presentaciones_pedidos').html("<select id='presentacion_cant_pedidos' class='form-control form-select input-sm validate[required]' style='width:100%;'><option value='39'>SIN PRESENTACION</option></select>");
                } else {
                    //items += "<option value='n'>--Seleccione--</option>";
                    $('#modal_cantidad_pedidos #divlistado_presentaciones_pedidos').html("<select id='presentacion_cant_pedidos' class='form-control form-select input-sm validate[required]' style='width:100%;'>" + items + "</select>");
                }

            });

            /*
            $.getJSON('/Productos/GetPresentacionesCodPres/?codigoproducto=' + codigoproducto, function (data) {
                var items = "<option value='0'>--Sin presentacion--</option>";
                var count = 0;
                $.each(data, function (i, district) {
                    count = 1;
                    items += "<option style='height:30px' value='" + district.codigo + "' >" + district.nombre + "</option>";
                });
                if (count == 0) {
                    $('#modal_cantidad_pedidos #divlistado_presentaciones_pedidos').html("<select id='presentacion_cant_pedidos' class='form-control form-select input-sm validate[required]' style='width:100%;'><option value='0'></option></select>");
                } else {
                    $('#modal_cantidad_pedidos #divlistado_presentaciones_pedidos').html("<select id='presentacion_cant_pedidos' class='form-control form-select input-sm validate[required]' style='width:100%;'>" + items + "</select>");
                }
            });
            */

            $.ajaxSetup({
                async: true
            });


        }
        function guardarCajasFacturacion() {

            var retorno = 1;
            var estado="0";
            var facturar = "0";
            if ($("#ok_facturar").prop('checked')) { facturar = "1" };

            if (facturar == "1") {
                var estado = "1";

                //mostrar_msj_error("para enviar a facturar, el pedido debe estar terminado");
                //return false;
            }

            var entregaboleta = "0";
            if ($("#entregaboleta").prop('checked')) { entregaboleta = "1" };
            //carrito = [];
            //cargar_detalle_pedido(global_registro);
            //cantidad_carro = carrito.length;
            //if (cantidad_carro == 0) {
            //    mostrar_msj_error("Debe haber al menos un elemento en el carro");
            //    retorno = 0;
            //}
            var ok = 1;
            var total = 0;
            for (let pedido of carrito) {
                debugger;
                var qreal = parseFloat(pedido.cantidadreal == "" || pedido.cantidadreal == "0" ? "0" : pedido.cantidadreal);
                if (pedido.codigo != codigominimo && qreal == 0 && pedido.obsdet == "") { ok = 0; }
                if (pedido.valor == "") { pedido.valor = "0"; }
                total += parseInt(pedido.valor);
            }
            if (ok == 0) {
                mostrar_msj_error("Debe ingresar cantidades reales a cada producto");
                retorno = 0;
            }

            var valor = $("#cajas").val();
            if (valor == "") { valor = "0"; }
            var cajas = parseInt(valor);

            var valor = $("#bolsas").val();
            if (valor == "") { valor = "0"; }
            var bolsas = parseInt(valor);

            if (cajas == 0 && bolsas == 0) {
                mostrar_msj_advertencia("Debe señalar cantidad de cajas o bolsas");
                retorno = 0;
            }

            if (retorno == 1) {
                $('#modal_confirma_guardarpesoreal').modal("hide");
                $('#modal_pesos_reales').modal("hide");
                //$(this).prop('disabled', true);
                $("#saving").css("display", "");
                $.ajax({
                    async: false,
                    type: "POST",
                    url: '/Pedidos/CambiarEstado/',
                    data: JSON.stringify(
                        {
                            registro: global_registro,
                            total: total,
                            estado: estado,
                            cajas: cajas.toString(),
                            bolsas: bolsas.toString(),
                            am: global_am,
                            pm: global_pm,
                            operario: global_nombreoperario,
                            obs: global_obs,
                            facturar: facturar,
                            entregaboleta: entregaboleta,
                            carrito: carrito
                        }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if (data.retornojson == "1") {

                            if (facturar == "1") {
                                //mostrar_msj_success('Pedido cerrado y enviado a facturacion');
                                table_pedidos_maestro.row($("#estado_" + fila_proceso).parents('tr')).remove().draw();
                            } else {
                                //$("#estado_" + fila_proceso).val(nombre);
                                $("#btbeditar_" + fila_proceso).attr("estado", estado);
                            }
                        } else if (data.retornojson == "0") {
                            mostrar_msj_error("pedido sin detalle real!!");
                        } else if (data.retornojson == "-1") {
                            mostrar_msj_error(data.mensajejson);
                        } else {
                            mostrar_msj_error(data.errorjson);
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        mostrar_msj_error("Error de Conexion");
                    }
                });
            }
            return retorno;
        }

        function cargar_comunas(texto) {

            $.getJSON('/Pedidos/GetComunas/?nombre=' + texto, function (data) {

                var items = "<option value='0' >--Comunas--</option>";
                $("#idcomuna").empty();
                var count = 0;
                $.each(data, function (i, district) {
                    count = 1;
                    items += "<option value='" + district.nombre.trim() + "'>" + district.nombre.trim() + "</option>";
                });

                if (count == 0) {
                    $('#idcomuna').html("<option value='0' >No hay datos</option>");
                } else {
                    $('#idcomuna').html(items);
                }
                //$("#idcomuna").selectpicker('refresh');

            });
        }

    function guardar_avancereal() {
        //$.ajax({
        //    type: "POST",
        //    url: '/Pedidos/Guardar_AvanceReal/',
        //    data: JSON.stringify(
        //        {
        //            registro: global_registro,
        //            avancereal: global_avancereales
        //        }),
        //    contentType: "application/json; charset=utf-8",
        //    dataType: "json",
        //    async: false,
        //    success: function (data) {
        //        if (data.retornojson == "1") {
        //
        //            $("#btneditar_" + fila_proceso).attr("data-avancereales", global_avancereales);
        //            $("#hidden_" + fila_proceso).val(global_avancereales);
        //            switch (global_avancereales) {
        //                case "0": $("#fila_" + fila_proceso).css('background-color', 'White'); break;
        //                case "1": $("#fila_" + fila_proceso).css('background-color', 'Yellow'); break;
        //                case "2": $("#fila_" + fila_proceso).css('background-color', 'Orange'); break;
        //                case "3": $("#fila_" + fila_proceso).css('background-color', '#88F256'); break;
        //            }
        //            switch (global_avancereales) {
        //                case "0": $("#estado_" + fila_proceso).css('background-color', 'White'); break;
        //                case "1": $("#estado_" + fila_proceso).css('background-color', 'Yellow'); break;
        //                case "2": $("#estado_" + fila_proceso).css('background-color', 'Orange'); break;
        //                case "3": $("#estado_" + fila_proceso).css('background-color', '#88F256'); break;
        //            }
        //            switch (global_avancereales) {
        //                case "0": $("#operario_" + fila_proceso).css('background-color', 'White'); break;
        //                case "1": $("#operario_" + fila_proceso).css('background-color', 'Yellow'); break;
        //                case "2": $("#operario_" + fila_proceso).css('background-color', 'Orange'); break;
        //                case "3": $("#operario_" + fila_proceso).css('background-color', '#88F256'); break;
        //            }
        //            $('#modal_pesos_reales').modal("hide");
        //            //cargar_pedidos("");+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        //        } else if (data.retornojson == "-1") {
        //            mostrar_msj_error(data.mensajejson);

        //        } else {
        //            mostrar_msj_error(data.errorjson);
        //        }
        //    },
        //    error: function (XMLHttpRequest, textStatus, errorThrown) {
        //        mostrar_msj_error("error de Conexion");
        //    }
        //});
    }

    function cambiar_operario() {
        var arreglo = $("#modal_cambiar_operario #operario").val();
        var operario = arreglo[0];
        var nombre = $("#operario option:selected").text();
        if (nombre == "") { operario = "0"; }
        $.ajax({
            type: "POST",
            url: '/Pedidos/CambiarOperario/',
            traditional: true,
            data: {
                registro: global_registro,
                operario: operario
            },
            dataType: "json",
            success: function (data) {
                if (data.retornojson == "1") {
                    //mostrar_msj_success('Operario cambiado');
                    $("#operario_" + fila_proceso).val(nombre);
                    $("#operario_" + fila_proceso).attr("data-operario", operario);
                    $("#operario_" + fila_proceso).attr("data-nombreoperario", nombre);
                    $("#btbeditar_" + fila_proceso).attr("data-operario", operario);
                    //cargar_pedidos("");
                } else if (data.retornoJson == "-1") {
                    mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                    window.location.href = "/../Home/Login";

                } else {
                    mostrar_msj_advertencia(data.mensajejson);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                mostrar_msj_error("error de Conexion");
            }
        });
    }

    function cargar_minimo() {
        var retorno = 0;
        $("#saving").css("display", "");
        $.ajax({
            type: "POST",
            url: '/Pedidos/Leer_Peso_Minimo/',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            success: function (data) {
                if (data.retornojson == "1") {
                    $("#saving").css("display", "none");
                    pesominimo = parseFloat(data.pesojson);
                    montominimo = parseFloat(data.montojson);
                    codigominimo = data.codigojson;
                    nombreminimo = data.nombrejson;
                    valorminimo = data.valorjson;
                    retorno = 1;
                } else if (data.retornojson == "-1") {
                    mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                    window.location.href = "/../Home/Login";
                } else {
                    mostrar_msj_error(data.mensajejson);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                mostrar_msj_error("error de Conexion");
            }
        });
        return retorno;
    }

    function guardar_peso_real(item_carrito) {
        var retorno=1;
        //$("#saving").css("display", "");
        //$.ajax({
        //    type: "POST",
        //    url: '/Pedidos/Guardar_Item_Modificado/',
        //    data: JSON.stringify({
        //        detalle: item_carrito
        //    }),
        //    contentType: "application/json; charset=utf-8",
        //    dataType: "json",
        //    async: false,
        //    success: function (data) {
        //        if (data.retornoJson == 1) {
        //            $("#saving").css("display", "none");
        //            retorno= 1;
        //        } else if (data.retornoJson == -1) {
        //            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
        //            window.location.href = "/../Home/Login";
        //        } else {
        //            mostrar_msj_error(data.errorJson);
        //        }
        //    },
        //    error: function (XMLHttpRequest, textStatus, errorThrown) {
        //        mostrar_msj_error("error de Conexion");
        //    }
        //});
        return retorno;
    }

    function guardar_cobro_peso_minimo(registro,item_carrito) {
        var retorno = 1;
        //
        //$("#saving").css("display", "");
        //$.ajax({
        //    type: "POST",
        //    url: '/Pedidos/Guardar_Cobro_Peso_Minimo/',
        //    data: JSON.stringify({
        //        registro:registro,
        //        detalle: item_carrito
        //    }),
        //    contentType: "application/json; charset=utf-8",
        //    dataType: "json",
        //    async: false,
        //    success: function (data) {
        //
        //        if (data.retornojson == "1") {
        //            $("#saving").css("display", "none");
        //            retorno = 1;
        //        } else if (data.retornojson == "-1") {
        //            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
        //            window.location.href = "/../Home/Login";
        //        } else {
        //            mostrar_msj_error(data.mensajeson);
        //        }
        //    },
        //    error: function (XMLHttpRequest, textStatus, errorThrown) {
        //        mostrar_msj_error("error de Conexion");
        //    }
        //});
        return retorno;
    }

    function eliminar_cobro_peso_minimo(referencia) {
        var retorno = 1;
        //
        //$("#saving").css("display", "");
        //$.ajax({
        //    type: "POST",
        //    url: '/Pedidos/Eliminar_Cobro_Peso_Minimo/',
        //    data: JSON.stringify({
        //        referencia: referencia
        //    }),
        //    contentType: "application/json; charset=utf-8",
        //    dataType: "json",
        //    async: false,
        //    success: function (data) {
        //
        //        if (data.retornojson == "1") {
        //            $("#saving").css("display", "none");
        //            retorno = 1;
        //        } else if (data.retornojson == "-1") {
        //            mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
        //            window.location.href = "/../Home/Login";
        //        } else {
        //            mostrar_msj_error(data.mensajeson);
        //        }
        //    },
        //    error: function (XMLHttpRequest, textStatus, errorThrown) {
        //        mostrar_msj_error("error de Conexion");
        //    }
        //});
        return retorno;
    }

    //
    function traspasar_chofer() {
        $.ajax({
            type: "POST",
            url: '/Pedidos/TraspasoPedidoChofer/',
            data: JSON.stringify({
                pedidos: pedidos
            }),
            contentType: "application/json; charset=utf-8",
            dataType: false,
            success: function (result) {

                /*
                debugger;
                $("#loading").hide();
                if (result == -1) {
                    mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                    window.location.href = "/../Home/Login";
                } else {
                    $("#modal_pesos_reales").on("shown.bs.modal", function () {
                        var table = $('#table_carrito_pedidos').DataTable();
                        table.columns.adjust();
                    });
                    $("#avancereales").val(global_avancereales);
                    $("#divpartialdetallepedido").html(result);
                }
                */
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                mostrar_msj_error("error de Conexión: no pudo acceder a la vista");
            }
        });

    }

    function cargar_pedidos(cliente) {

        var url_action = '@Html.Raw(Url.Action("partialListado_Pedidos_PorCargar", "Pedidos", new {
                                 fecha = "_fecha",
                                 fechatermino = "_fechatermino",
                                 cliente = "_cliente",
                                 opt_cargado= "_opt_cargado",
                                 tipopedido="_tipopedido",
                                 comuna="_comuna",
                                 rutchofer="_rutchofer",
                                 patente="_patente"
                     }))';
        //
        url_action = url_action.replace("_fecha", $("#idfecha").val())
            .replace("_fechatermino", $("#idfechatermino").val())
            .replace("_cliente", "")
            .replace("_opt_cargado", $("#listado_cargados").val())
            .replace("_tipopedido", $("#listado_tipopedido").val())
            .replace("_comuna", $("#listado_comunas").val())
            .replace("_rutchofer", $("#listado_choferes").val())
            .replace("_patente", $("#listado_patente").val());
        $("#saving").css("display", "");
        $.ajax({
            contentType: false,
            processData: false,
            type: 'POST',
            url: url_action,
            success: function (result) {
                $("#saving").hide();
                if (result == -1) {
                    mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                    window.location.href = "/../Home/Login";
                } else {
                    $("#idDivPartialProcesoPedidos").html(result);
                }
            }
        });
    }

    function cargar_detalle_pedido(registro) {
        carrito = [];
        $.ajaxSetup({
            async: false
        });
        $.getJSON('/Pedidos/GetDetallePedido/?registro=' + registro.toString(), function (data) {
            var count = 0;
            $.each(data, function (i, item) {
                count = 1;
                var codigo = item.codigo;
                var detalle = item.detalle;
                var cantidad = item.cantidad;
                var presentacion = item.presentacion;
                var nombpresentacion = item.nombpresentacion;
                var cabeza = item.cabeza;
                var esquelon = item.esquelon;
                var cantidadreal = item.cantidadreal;
                var unidad = item.unidad;
                var precio = item.precio;
                var valor = item.valor;
                var obsdet = item.obsdet;
                var anulado = item.anulado;
                var pesogrs = item.pesogrs;
                var referencia = item.referencia;
                var descuento1 = item.descuento1;
                var fila = {
                    codigo: codigo,
                    detalle: detalle,
                    cantidad: cantidad,
                    presentacion: presentacion,
                    nombpresentacion: nombpresentacion,
                    cabeza: cabeza,
                    esquelon: esquelon,
                    cantidadreal: cantidadreal,
                    unidad: unidad,
                    precio: precio,
                    descuento1: descuento1,
                    valor: valor,
                    obsdet: obsdet,
                    anulado: anulado,
                    pesogrs: pesogrs,
                    referencia: referencia
                }
                carrito.push(fila);
            });
        });
        $.ajaxSetup({
            async: true
        });
    }


    function ver_fotos_pedido(numpedido) {
        //
        $.ajax({
            type: "POST",
            url: '/Pedidos/partialVerFoto/',
            data: JSON.stringify({ registro: numpedido }),
            contentType: "application/json; charset=utf-8",
            dataType: false,
            success: function (result) {

                console.log(result)


                $("#loading").hide();
                if (result == -1) {
                    mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                    window.location.href = "/../Home/Login";
                } else {

                    //
                    $("#idPartialVerFoto").html(result);
                    $("#modal_fotos_despacho").modal("show");
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                mostrar_msj_error("error de Conexión: no pudo acceder a la vista");
            }
        });

    }


        function editar_detalle_pedido() {
            $.ajax({
                type: "POST",
                url: '/Pedidos/partialPesosReales/',
                data: JSON.stringify({ carrito: carrito, opt: 1 }),
                contentType: "application/json; charset=utf-8",
                dataType: false,
                success: function (result) {
                    $("#loading").hide();
                    if (result == -1) {
                        mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                        window.location.href = "/../Home/Login";
                    } else {
                        $("#modal_pesos_reales").on("shown.bs.modal", function () {
                            var table = $('#table_carrito_pedidos').DataTable();
                            table.columns.adjust();
                        });
                        $("#modal_pesos_reales").modal("show");
                        $("#avancereales").val(global_avancereales);
                        $("#divpartialdetallepedido").html(result);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mostrar_msj_error("error de Conexión: no pudo acceder a la vista");
                }
            });

        }
        function editar_detalle_pedido_agregar() {
            $.ajax({
                type: "POST",
                url: '/Pedidos/partialPesosReales/',
                data: JSON.stringify({ carrito: carrito }),
                contentType: "application/json; charset=utf-8",
                dataType: false,
                success: function (result) {
                    debugger;
                    $("#loading").hide();
                    if (result == -1) {
                        mostrar_msj_error("Su Sessión a ha expirado. Ingrese al Sistema nuevamente");
                        window.location.href = "/../Home/Login";
                    } else {
                        $("#modal_pesos_reales").on("shown.bs.modal", function () {
                            var table = $('#table_carrito_pedidos').DataTable();
                            table.columns.adjust();
                        });

                        $("#avancereales").val(global_avancereales);
                        $("#divpartialdetallepedido").html(result);

                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    mostrar_msj_error("error de Conexión: no pudo acceder a la vista");
                }
            });

        }

    function cargar_estados(estado) {

        $.getJSON('/Pedidos/GetEstados/?nombre=' + estado, function (data) {
            //var items = "<option value='0'>--Seleccione--</option>";
            $("#modal_cambiar_estado #divlistado_estados").empty();
            var count = 0;
            var items = "";
            $.each(data, function (i, district) {
                count = 1;
                items += "<option style='height:30px' value='" + district.codigo + "' data-nombre='" + district.nombre + "' >" + district.nombre + "</option>";
            });
            if (count == 0) {
                $('#modal_cambiar_estado #divlistado_estados').html("<select id='estado' multiple='multiple' size='5' class='form-select input-sm' style='width:100%;'><option value='0' data-nombre=''>No hay datos</option></select>");
            } else {
                $('#modal_cambiar_estado #divlistado_estados').html("<select id='estado' multiple='multiple' size='5' class='form-select input-sm' style='width:100%;'>" + items + "</select>");
            }
        });
    }

    function cargar_operarios(operario) {

        $.getJSON('/Pedidos/GetOperarios/?nombre=' + operario, function (data) {
            $("#modal_cambiar_operario #divlistado_operarios").empty();
            var count = 0;
            var items = "";
            $.each(data, function (i, district) {
                count = 1;
                items += "<option style='height:30px' value='" + district.codigo + "'>" + district.nombre + "</option>";
            });
            if (count == 0) {
                $('#modal_cambiar_operario #divlistado_operarios').html("<select id='operario' multiple='multiple' size='5' class='form-select input-sm' style='width:100%;'><option value='0'>No hay datos</option></select>");
            } else {
                $('#modal_cambiar_operario #divlistado_operarios').html("<select id='operario' multiple='multiple' size='5' class='form-select input-sm' style='width:100%;'>" + items +"</select>");
            }
        });
    }

    function limpiarGuardar() {
        $(".limpiar").val("");
    }

    function cargar_presentaciones_modifica_peso_Item_pedido(codigoproducto, nombpres, codpres) {

        $.ajaxSetup({
            async: false
        });

        $.getJSON('/Productos/GetPresentacionesCodPres/?codigoproducto=' + codigoproducto, function (data) {
            var items = "<option value="+codpres+">" + nombpres + "</option>";
            //var items = "";
            var count = 0;
            $.each(data, function (i, district) {
                count = 1;
                items += "<option style='height:30px' value='" + district.codigo + "' >" + district.nombre + "</option>";
            });

            if (count == 0) {
                $('#modal_modifica_peso_item_pedido #divlistado_presentaciones_modifica_peso_item_pedido').html("<select id='presentacion_modifica_peso_item_pedido' class='form-select input-sm validate[required]' style='width:100%;'><option value='39'>SIN PRESENTACION</option></select>");
            } else {
                $('#modal_modifica_peso_item_pedido #divlistado_presentaciones_modifica_peso_item_pedido').html("<select id='presentacion_modifica_peso_item_pedido' class='form-select input-sm validate[required]' style='width:100%;'>" + items + "</select>");
            }
            });

            $.ajaxSetup({
                async: true
            });
    }

        function cargar_presentaciones_modifica_peso_Item_pedido_codprod(codigoproducto) {

            $.ajaxSetup({
                async: false
            });

            $.getJSON('/Productos/GetPresentacionesCodPres/?codigoproducto=' + codigoproducto, function (data) {
                //var items = "<option value='0'>--Sin presentacion--</option>";
                var items = "";
                //$("#modal_producto_agregar #unidad_prod").empty();
                var count = 0;
                $.each(data, function (i, district) {
                    count = 1;
                    items += "<option style='height:30px' value='" + district.codigo + "' >" + district.nombre + "</option>";
                });
                if (count == 0) {
                    $('#modal_modifica_peso_item_pedido #divlistado_presentaciones_modifica_peso_item_pedido').html("<select id='presentacion_modifica_peso_item_pedido' class='form-select input-sm validate[required]' style='width:100%;' disabled='disabled'><option value='39'>SIN PRESENTACION</option></select>");
                } else {
                    $('#modal_modifica_peso_item_pedido #divlistado_presentaciones_modifica_peso_item_pedido').html("<select id='presentacion_modifica_peso_item_pedido' class='form-select input-sm validate[required]' style='width:100%;' disabled='disabled'>" + items + "</select>");
                }
            });

            $.ajaxSetup({
                async: true
            });
        }

    function sumar_kilos_totales()
    {
        var kilos = 0;
        pt = 0;
        mt = 0;
        var indicador_web = parseInt(global_web);

        $('.reales').each(function ()
        {
            //debugger;
            if ($(this).data("codigo") == codigominimo & indicador_web==0)
            {
                //
                //var fila = $(this).data("fila");
                //$("#cantreal_"+fila).prop("disabled",true)
                //$("#btn_editar_" + fila).prop("disabled", true)
                //var precio = parseFloat($(this).data("precio"));
                //mt += parseFloat(precio);

                table_edicion_pedido
                    .row($(this).parents('tr'))
                    .remove()
                    .draw();

            } else {

                var fila = $(this).data("fila");
                $("#cantreal_" + fila).prop("disabled", false)
                $("#btn_editar_" + fila).prop("disabled", false);
                if ($(this).data("codigo") == codigominimo & indicador_web == 1) {
                    $("#cantreal_" + fila).val(1);
                    $("#cantreal_" + fila).prop("disabled", true);
                    $("#btn_editar_" + fila).addClass("ocultar_boton");
                }
                var cantidad = parseFloat($(this).val());
                var pesogrs = parseFloat($(this).data("pesogrs"));
                if (pesogrs == 0) { pesogrs = 1000; }
                var precio = parseFloat($(this).data("precio"));
                var monto = redondear(cantidad * precio, 0);
                kilos = redondear(cantidad * pesogrs / 1000, 2);
                pt += parseFloat(kilos);
                mt += parseFloat(monto);
            }
        });

        //$("#pesototal").val(pt.toString().replace(",", "."));
        //$("#montototal").val(mt.toString().replace(",", "."));

        if (indicador_web== 0) {
        var ok = true;
        while (ok) {
            var foundIndex = carrito.findIndex(x => x.codigo == codigominimo);
            if (foundIndex >= 0) {
                carrito.splice(foundIndex, 1);
            } else { ok = false; }
        }

        valorminimo = 0;

        //si web==1, saltar

           // if (mt < 30000 && mt > 0) {
            if (mt < tramo1 && mt > 0) {
                valorminimo = valort1; //3500;//de tabla parametros valorT1
                var fila = {
                    codigo: codigominimo,
                    detalle: nombreminimo,
                    cantidad: 1,
                    presentacion: "0",
                    cabeza: "0",
                    esquelon: "0",
                    cantidadreal: "1",
                    unidad: "UN",
                    precio: valorminimo,
                    descuento1: 0,
                    valor: valorminimo,
                    obsdet: "...",
                    anulado: "0",
                    referencia: "0"
                }
                carrito.push(fila);
                AddNewRow(fila);
                mt += valorminimo;
                //} else if (mt < 50000 && mt > 0) {
            } else if (mt < tramo2 && mt > 0) {
                valorminimo = valort2; //2490;//de tabla parametros valorT1
                var fila = {
                    codigo: codigominimo,
                    detalle: nombreminimo,
                    cantidad: 1,
                    presentacion: "0",
                    cabeza: "0",
                    esquelon: "0",
                    cantidadreal: "1",
                    unidad: "UN",
                    precio: valorminimo,
                    descuento1: 0,
                    valor: valorminimo,
                    obsdet: "...",
                    anulado: "0",
                    referencia: "0"
                }
                carrito.push(fila);
                AddNewRow(fila);
                mt += valorminimo;
            }
        }


    }
        function AddNewRow(fila) {
            var table = document.getElementById("table_edicion_pedido");
            var row = table.insertRow(table.rows.length);

            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            var cell4 = row.insertCell(4);
            var cell5 = row.insertCell(5);

            cell0.innerHTML = fila.codigo;
            cell0.setAttribute("style", "vertical-align:middle !important");
            cell1.innerHTML = fila.detalle;
            cell1.setAttribute("style", "vertical-align:middle !important");
            cell2.innerHTML = "1.00";
            cell2.setAttribute("style", "vertical-align:middle !important");
            cell2.classList.add("text-right");
            cell3.innerHTML = "<input class='form-control_normal text-right reales' type='text' value='1' onfocus='this.select()' data-codigo='"+fila.codigo+"' disabled>";
            cell3.setAttribute("style", "vertical-align:middle !important");
            cell4.innerHTML = "UN";
            cell4.setAttribute("style", "vertical-align:middle !important");
            cell5.innerHTML = "<button type='button' class='eliminarItemDespacho' data-codigo='405' style='width:100%'>X</button >";
            cell4.setAttribute("style", "vertical-align:middle !important");
        }
</script>
@*}*@
